<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caso DataNova: Gesti√≥n Intergeneracional</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, 'Segoe UI', sans-serif; background: #f9fafb; color: #1f2937; padding-bottom: 50px; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); padding: 30px; }
        
        /* Botones */
        .btn { padding: 10px 16px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-size: 14px; transition: all 0.2s; }
        .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn-primary { background: #2563eb; color: white; }
        .btn-secondary { background: #7c3aed; color: white; }
        .btn-success { background: #16a34a; color: white; }
        .btn-danger { background: #dc2626; color: white; }
        .btn-gray { background: #6b7280; color: white; }
        .btn-outline { background: white; border: 1px solid #d1d5db; color: #374151; }

        /* Inputs Generales */
        .input, .textarea, .select { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; margin-bottom: 10px; }
        .input:focus, .textarea:focus { outline: 2px solid #2563eb; border-color: transparent; }
        .label { display: block; font-size: 12px; font-weight: 700; color: #4b5563; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

        /* Login */
        .login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #4f46e5, #0ea5e9); }
        .login-card { background: white; padding: 40px; border-radius: 16px; width: 100%; max-width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }

        /* Cajas de Edici√≥n */
        .edit-section { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .edit-title { font-size: 18px; font-weight: 700; margin-bottom: 15px; color: #1e293b; display: flex; align-items: center; gap: 8px; }
        .question-editor { background: white; border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .question-editor-header { font-weight: bold; margin-bottom: 10px; color: #2563eb; border-bottom: 1px solid #f1f5f9; padding-bottom: 5px; }

        /* Tablas y Resultados */
        .table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .table th { text-align: left; padding: 12px; background: #f1f5f9; color: #64748b; font-size: 13px; font-weight: 700; }
        .table td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 700; }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-red { background: #fee2e2; color: #991b1b; }

        /* Estilo Alumno */
        .case-content { line-height: 1.6; color: #334155; white-space: pre-line; margin-bottom: 30px; padding: 20px; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6; }
        .question-card { margin-bottom: 20px; padding: 20px; border: 1px solid #e2e8f0; border-radius: 8px; }
        .option-label { display: flex; align-items: center; gap: 10px; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: background 0.2s; }
        .option-label:hover { background: #f8fafc; }
        
        .feedback-box { margin-top: 10px; padding: 10px; background: #f8fafc; border-radius: 6px; font-size: 14px; font-style: italic; color: #64748b; }
        .correct-answer { color: #16a34a; font-weight: bold; margin-bottom: 5px; }
        .wrong-answer { color: #dc2626; font-weight: bold; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- DATOS DEL CASO (DATANOVA) ---
        const DEFAULT_CASE = {
            title: "Caso: DataNova y el Proyecto Aurora",
            content: "DataNova es una empresa latinoamericana de soluciones tecnol√≥gicas que ha crecido r√°pidamente durante los √∫ltimos cinco a√±os. Para mantenerse competitiva frente al aumento de startups en la regi√≥n, la direcci√≥n decide lanzar ‚ÄúAurora‚Äù, un servicio de anal√≠tica predictiva que integrar√° datos de distintas industrias. Debido a su complejidad, se conforma un equipo intergeneracional con perfiles complementarios.\n\nEl equipo est√° formado por:\n- Marta (62 a√±os): Analista senior, met√≥dica y orientada a la documentaci√≥n.\n- Luis (45 a√±os): Jefe de proyecto, mediador y eficiente.\n- Camila (29 a√±os): UX, √°gil y de comunicaci√≥n informal.\n- Diego (23 a√±os): Programador junior, adaptable pero inexperto en pol√≠tica interna.\n\nDurante la fase inicial del proyecto, la empresa impulsa la modalidad h√≠brida. Sin embargo, el equipo enfrenta diferentes expectativas generacionales sobre el trabajo. Marta prefiere formalidad y an√°lisis previo. Camila y Diego buscan iteraci√≥n r√°pida y canales digitales. \n\nLuis intenta conciliar ambos mundos, notando que las tensiones son culturales y no solo t√©cnicas."
        };

        const DEFAULT_QUESTIONS = [
            { id: 1, type: 'multiple', question: '¬øCu√°l es el principal desaf√≠o intergeneracional del caso?', options: ['Falta de recursos financieros.', 'Diferencias en ritmos, estilos de comunicaci√≥n y expectativas.', 'Poca preparaci√≥n t√©cnica de los miembros j√≥venes.', 'Exceso de supervisi√≥n por parte de la gerencia.'], correct: 1, feedback: 'El texto menciona expl√≠citamente diferencias en ritmos, percepci√≥n de autoridad y formas de comunicar desacuerdos.' },
            { id: 2, type: 'multiple', question: '¬øQu√© oportunidad puede aprovechar el equipo?', options: ['La uniformidad en las preferencias laborales.', 'La complementariedad entre experiencia profunda y pensamiento innovador.', 'La posibilidad de delegar todo a la generaci√≥n m√°s joven.', 'Reducir las reuniones para evitar conflictos.'], correct: 1, feedback: 'El caso destaca que cuando se sincronizan, la experiencia de Marta reduce riesgos y la innovaci√≥n de Camila/Diego genera valor.' },
            { id: 3, type: 'multiple', question: '¬øCu√°l ser√≠a una acci√≥n efectiva de liderazgo para Luis?', options: ['Permitir que cada generaci√≥n trabaje por separado.', 'Evitar intervenir para que los conflictos se resuelvan solos.', 'Establecer espacios de alineamiento y m√©todos h√≠bridos.', 'Centralizar todas las decisiones en √©l.'], correct: 2, feedback: 'Luis debe integrar el rigor (Marta) con la agilidad (Camila/Diego) mediante un modelo de gesti√≥n h√≠brido.' },
            { id: 4, type: 'truefalse', question: 'V/F: Las tensiones del equipo son exclusivamente consecuencia de la diferencia de edades.', options: [], correct: false, feedback: 'Falso. El caso menciona que las tensiones son tambi√©n culturales, de estilos de trabajo y percepci√≥n de autoridad, no solo biol√≥gicas.' },
            { id: 5, type: 'short', question: '¬øQu√© estrategia concreta propondr√≠as para fortalecer la colaboraci√≥n?', correctAnswers: ['mentoring', 'mentor√≠a', 'feedback', 'comunicaci√≥n', 'h√≠brido', 'integraci√≥n', 'equipos mixtos', 'alineamiento'], feedback: 'Estrategias como el mentoring inverso, acuerdos de comunicaci√≥n o sesiones de alineamiento cultural son respuestas v√°lidas.' }
        ];

        const App = () => {
            const [view, setView] = useState('login');
            const [password, setPassword] = useState('');
            const [studentName, setStudentName] = useState('');
            
            // Datos Editables
            const [caseData, setCaseData] = useState(DEFAULT_CASE);
            const [questions, setQuestions] = useState(DEFAULT_QUESTIONS);
            
            // Estado Examen
            const [answers, setAnswers] = useState({});
            const [submitted, setSubmitted] = useState(false);
            const [studentResults, setStudentResults] = useState([]);
            const [editMode, setEditMode] = useState(false);

            // Cargar datos al inicio
            useEffect(() => {
                const savedRes = localStorage.getItem('student-results');
                if (savedRes) setStudentResults(JSON.parse(savedRes));
                
                const savedCase = localStorage.getItem('custom-case');
                if (savedCase) setCaseData(JSON.parse(savedCase));
                
                const savedQs = localStorage.getItem('custom-questions');
                if (savedQs) setQuestions(JSON.parse(savedQs));
            }, []);

            // --- FUNCIONES PROFESOR ---
            const saveChanges = () => {
                localStorage.setItem('custom-case', JSON.stringify(caseData));
                localStorage.setItem('custom-questions', JSON.stringify(questions));
                setEditMode(false);
                alert('‚úÖ Cambios guardados correctamente.');
            };

            const restoreDefaults = () => {
                if(confirm('¬øVolver a las preguntas originales?')) {
                    setCaseData(DEFAULT_CASE);
                    setQuestions(DEFAULT_QUESTIONS);
                    localStorage.removeItem('custom-case');
                    localStorage.removeItem('custom-questions');
                    setEditMode(false);
                }
            };
            
            const clearData = () => {
                if(confirm('¬øBORRAR TODOS LOS RESULTADOS?')) {
                    setStudentResults([]);
                    localStorage.removeItem('student-results');
                }
            };

            const updateQ = (id, field, val) => {
                setQuestions(questions.map(q => q.id === id ? {...q, [field]: val} : q));
            };
            
            const updateOpt = (qId, idx, val) => {
                const newQs = questions.map(q => {
                    if(q.id !== qId) return q;
                    const newOpts = [...q.options];
                    newOpts[idx] = val;
                    return {...q, options: newOpts};
                });
                setQuestions(newQs);
            };

            // --- FUNCIONES EXAMEN ---
            const submitExam = () => {
                if(questions.some(q => answers[q.id] === undefined)) return alert('Faltan preguntas por responder');
                
                const results = questions.map(q => {
                    let isCorrect = false;
                    if(q.type === 'multiple' || q.type === 'truefalse') isCorrect = answers[q.id] === q.correct;
                    if(q.type === 'short') isCorrect = q.correctAnswers.some(a => answers[q.id].toLowerCase().includes(a.toLowerCase()));
                    
                    return { ...q, userAnswer: answers[q.id], correct: isCorrect };
                });

                const newRecord = { name: studentName, date: new Date(), results };
                const updated = [...studentResults, newRecord];
                setStudentResults(updated);
                localStorage.setItem('student-results', JSON.stringify(updated));
                setSubmitted(true);
            };

            const downloadCSV = () => {
                const csv = "Nombre,Nota,Aciertos\n" + studentResults.map(r => {
                    const hits = r.results.filter(x=>x.correct).length;
                    return `${r.name},${((hits/r.results.length)*100).toFixed(0)}%,${hits}/${r.results.length}`;
                }).join('\n');
                const a = document.createElement('a');
                a.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
                a.download = 'notas.csv';
                a.click();
            };

            // --- VISTAS ---
            if(view === 'login') {
                return (
                    <div className="login-screen">
                        <div className="login-card">
                            <h2 style={{textAlign:'center', marginBottom:'20px'}}>Acceso al Caso</h2>
                            <label className="label">Estudiante</label>
                            <input className="input" placeholder="Tu nombre..." value={studentName} onChange={e=>setStudentName(e.target.value)} />
                            <button className="btn btn-primary" style={{width:'100%', justifyContent:'center'}} onClick={()=>{if(studentName) setView('exam'); else alert('Nombre requerido');}}>Entrar</button>
                            
                            <div style={{margin:'20px 0', borderTop:'1px solid #e2e8f0'}}></div>
                            
                            <label className="label">Profesor</label>
                            <input type="password" className="input" placeholder="Contrase√±a" value={password} onChange={e=>setPassword(e.target.value)} />
                            <button className="btn btn-secondary" style={{width:'100%', justifyContent:'center'}} onClick={()=>{if(password==='profesor123') setView('admin'); else alert('Incorrecto');}}>Panel Profesor</button>
                        </div>
                    </div>
                );
            }

            if(view === 'admin') {
                return (
                    <div className="container">
                        <div className="card">
                            <div style={{display:'flex', justifyContent:'space-between', marginBottom:'20px'}}>
                                <h1>üë®‚Äçüè´ Panel Profesor</h1>
                                <button className="btn btn-gray" onClick={()=>setView('login')}>Salir</button>
                            </div>

                            {!editMode ? (
                                <div>
                                    <div style={{display:'flex', gap:'10px', marginBottom:'20px', flexWrap:'wrap'}}>
                                        <button className="btn btn-primary" onClick={()=>setEditMode(true)}>‚úèÔ∏è Editar Contenido</button>
                                        <button className="btn btn-success" onClick={downloadCSV}>üì• Descargar Excel</button>
                                        <button className="btn btn-danger" onClick={clearData}>üóëÔ∏è Borrar Notas</button>
                                    </div>
                                    <table className="table">
                                        <thead><tr><th>Alumno</th><th>Nota</th></tr></thead>
                                        <tbody>
                                            {studentResults.map((r,i) => {
                                                const hits = r.results.filter(x=>x.correct).length;
                                                return <tr key={i}><td>{r.name}</td><td><span className={`badge ${hits>=3?'badge-green':'badge-red'}`}>{hits}/{r.results.length}</span></td></tr>
                                            })}
                                        </tbody>
                                    </table>
                                    {studentResults.length===0 && <p style={{color:'#94a3b8', padding:'20px'}}>Sin resultados a√∫n.</p>}
                                </div>
                            ) : (
                                <div>
                                    <div style={{background:'#fff7ed', border:'1px solid #fed7aa', padding:'15px', borderRadius:'8px', marginBottom:'20px', color:'#9a3412'}}>
                                        Est√°s editando el contenido. Baja para ver las preguntas.
                                    </div>
                                    
                                    <div className="edit-section">
                                        <div className="edit-title">1. Texto del Caso</div>
                                        <label className="label">T√≠tulo</label>
                                        <input className="input" value={caseData.title} onChange={e=>setCaseData({...caseData, title:e.target.value})} />
                                        <label className="label">Contenido</label>
                                        <textarea className="textarea" rows="6" value={caseData.content} onChange={e=>setCaseData({...caseData, content:e.target.value})} />
                                    </div>

                                    <div className="edit-section">
                                        <div className="edit-title">2. Preguntas del Examen</div>
                                        {questions.map((q, i) => (
                                            <div key={q.id} className="question-editor">
                                                <div className="question-editor-header">Pregunta {i+1} ({q.type})</div>
                                                <label className="label">Enunciado</label>
                                                <input className="input" value={q.question} onChange={e=>updateQ(q.id, 'question', e.target.value)} />
                                                
                                                {q.type === 'multiple' && (
                                                    <div>
                                                        <label className="label">Opciones</label>
                                                        {q.options.map((opt, idx) => (
                                                            <input key={idx} className="input" value={opt} onChange={e=>updateOpt(q.id, idx, e.target.value)} placeholder={`Opci√≥n ${idx+1}`} />
                                                        ))}
                                                        <label className="label">√çndice Correcta (0=Primera opci√≥n)</label>
                                                        <input type="number" className="input" value={q.correct} onChange={e=>updateQ(q.id, 'correct', parseInt(e.target.value))} />
                                                    </div>
                                                )}

                                                {q.type === 'truefalse' && (
                                                    <div>
                                                        <label className="label">Respuesta Correcta</label>
                                                        <select className="select" value={q.correct.toString()} onChange={e => updateQ(q.id, 'correct', e.target.value === 'true')}>
                                                            <option value="true">Verdadero</option>
                                                            <option value="false">Falso</option>
                                                        </select>
                                                    </div>
                                                )}
                                                
                                                <label className="label">Feedback (Explicaci√≥n)</label>
                                                <input className="input" value={q.feedback} onChange={e=>updateQ(q.id, 'feedback', e.target.value)} />
                                            </div>
                                        ))}
                                    </div>

                                    <div style={{display:'flex', justifyContent:'flex-end', gap:'10px'}}>
                                        <button className="btn btn-outline" onClick={restoreDefaults}>Restaurar</button>
                                        <button className="btn btn-success" onClick={saveChanges}>üíæ Guardar Todo</button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if(view === 'exam') {
                if(submitted) {
                    const lastResult = studentResults[studentResults.length - 1];
                    const hits = lastResult.results.filter(x=>x.correct).length;
                    return (
                        <div className="container">
                            <div className="card" style={{textAlign:'center'}}>
                                <h1>Resultados: {hits} / {questions.length}</h1>
                                <div style={{textAlign:'left', marginTop:'30px'}}>
                                    {lastResult.results.map((r, i) => (
                                        <div key={i} className="question-card" style={{borderColor: r.correct ? '#86efac' : '#fca5a5'}}>
                                            <p><strong>{i+1}. {r.question}</strong></p>
                                            <p style={{marginBottom: '5px'}}>Tu respuesta: {r.userAnswer.toString()}</p>
                                            
                                            {/* L√≥gica de Mensajes Feedback */}
                                            {r.correct ? (
                                                <p className="correct-answer">¬°Excelente! Est√°s en lo correcto. üéâ</p>
                                            ) : (
                                                <div style={{marginBottom: '8px'}}>
                                                    <p className="wrong-answer">Incorrecto</p>
                                                    <p style={{color:'#dc2626', fontSize:'14px'}}>La respuesta correcta era: {r.correctAnswer}</p>
                                                </div>
                                            )}
                                            
                                            <div className="feedback-box">üí° {r.feedback}</div>
                                        </div>
                                    ))}
                                </div>
                                <button className="btn btn-primary" onClick={()=>setView('login')}>Salir</button>
                            </div>
                        </div>
                    );
                }
                
                return (
                    <div className="container">
                        <div className="card">
                            <h2 style={{color:'#2563eb', marginBottom:'15px'}}>{caseData.title}</h2>
                            <div className="case-content">{caseData.content}</div>
                            
                            <h3>Cuestionario</h3>
                            {questions.map((q, i) => (
                                <div key={q.id} className="question-card">
                                    <p style={{fontWeight:'bold', marginBottom:'10px'}}>{i+1}. {q.question}</p>
                                    
                                    {q.type === 'multiple' && q.options.map((opt, idx) => (
                                        <label key={idx} className="option-label">
                                            <input type="radio" name={`q${q.id}`} onChange={()=>setAnswers({...answers, [q.id]: idx})} /> {opt}
                                        </label>
                                    ))}
                                    
                                    {q.type === 'truefalse' && (
                                        <div style={{display:'flex', gap:'20px'}}>
                                            <label className="option-label"><input type="radio" name={`q${q.id}`} onChange={()=>setAnswers({...answers, [q.id]: true})} /> Verdadero</label>
                                            <label className="option-label"><input type="radio" name={`q${q.id}`} onChange={()=>setAnswers({...answers, [q.id]: false})} /> Falso</label>
                                        </div>
                                    )}

                                    {q.type === 'short' && (
                                        <textarea className="textarea" rows="2" onChange={e=>setAnswers({...answers, [q.id]: e.target.value})} placeholder="Respuesta..." />
                                    )}
                                </div>
                            ))}
                            <button className="btn btn-success" style={{width:'100%', justifyContent:'center'}} onClick={submitExam}>Enviar Examen</button>
                        </div>
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
