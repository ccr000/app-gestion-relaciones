<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de las Relaciones en las Organizaciones</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Simulaci√≥n de window.storage para GitHub Pages
        const storage = {
            async get(key, shared) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? { key, value: data, shared } : null;
                } catch (e) {
                    return null;
                }
            },
            async set(key, value, shared) {
                try {
                    localStorage.setItem(key, value);
                    return { key, value, shared };
                } catch (e) {
                    return null;
                }
            }
        };
        
        if (!window.storage) {
            window.storage = storage;
        }

        // Iconos SVG
        const Download = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
            </svg>
        );
        
        const Edit2 = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
            </svg>
        );
        
        const X = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );
        
        const Users = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
        );
        
        const BarChart3 = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 3v18h18"/><rect x="7" y="12" width="3" height="9"/>
                <rect x="14" y="8" width="3" height="13"/>
            </svg>
        );

        const App = () => {
            const [view, setView] = useState('login');
            const [userType, setUserType] = useState(null);
            const [studentName, setStudentName] = useState('');
            const [currentStudent, setCurrentStudent] = useState(null);
            const [answers, setAnswers] = useState({});
            const [submitted, setSubmitted] = useState(false);
            const [results, setResults] = useState(null);
            const [editMode, setEditMode] = useState(false);
            const [studentResults, setStudentResults] = useState([]);

            const [caseData, setCaseData] = useState({
                title: "Caso: Conflicto en el Equipo de Desarrollo",
                content: `TechSolutions es una empresa de software con 50 empleados. El equipo de desarrollo est√° dividido: los desarrolladores senior quieren mantener las tecnolog√≠as actuales por estabilidad, mientras que los junior proponen migrar a tecnolog√≠as m√°s modernas.

Mar√≠a, la gerente de desarrollo, nota que la productividad ha bajado un 30% en los √∫ltimos dos meses. Las reuniones se han vuelto tensas y algunos desarrolladores junior han expresado su intenci√≥n de renunciar. Los clientes empiezan a quejarse por retrasos en las entregas.

Mar√≠a debe tomar una decisi√≥n que mantenga al equipo unido y restaure la productividad sin perder talento valioso.`
            });

            const [questions, setQuestions] = useState([
                {
                    id: 1,
                    type: 'multiple',
                    question: '¬øCu√°l es el principal problema de gesti√≥n que enfrenta Mar√≠a?',
                    options: [
                        'Falta de presupuesto',
                        'Conflicto generacional y de enfoques t√©cnicos',
                        'Ausencia de liderazgo',
                        'Problemas de comunicaci√≥n con clientes'
                    ],
                    correct: 1,
                    feedback: 'El conflicto central es entre dos grupos con diferentes perspectivas sobre la tecnolog√≠a a usar, reflejando un choque generacional y de filosof√≠as de trabajo.'
                },
                {
                    id: 2,
                    type: 'truefalse',
                    question: 'La ca√≠da de productividad es un s√≠ntoma del problema subyacente de relaciones en el equipo.',
                    correct: true,
                    feedback: 'Correcto. La baja productividad es una consecuencia del conflicto no resuelto entre los miembros del equipo.'
                },
                {
                    id: 3,
                    type: 'short',
                    question: 'Menciona UNA estrategia de gesti√≥n de conflictos que Mar√≠a podr√≠a implementar.',
                    correctAnswers: ['mediaci√≥n', 'di√°logo', 'negociaci√≥n', 'colaboraci√≥n', 'facilitaci√≥n', 'comunicaci√≥n'],
                    feedback: 'Buenas estrategias incluyen: mediaci√≥n entre ambos grupos, crear espacios de di√°logo, negociaci√≥n colaborativa, o facilitaci√≥n de acuerdos que integren ambas perspectivas.'
                },
                {
                    id: 4,
                    type: 'multiple',
                    question: '¬øQu√© stakeholders est√°n siendo afectados por este conflicto?',
                    options: [
                        'Solo los desarrolladores junior',
                        'Solo Mar√≠a como gerente',
                        'Desarrolladores, clientes y la empresa en general',
                        '√önicamente los clientes externos'
                    ],
                    correct: 2,
                    feedback: 'El conflicto tiene un impacto m√∫ltiple: afecta a ambos grupos de desarrolladores, a los clientes que experimentan retrasos, y a la empresa que pierde productividad y puede perder talento.'
                },
                {
                    id: 5,
                    type: 'truefalse',
                    question: 'Ignorar el conflicto y esperar que se resuelva solo es una estrategia viable en este caso.',
                    correct: false,
                    feedback: 'Falso. El conflicto ya ha causado ca√≠da de productividad, tensi√≥n en reuniones, y riesgo de renuncia de empleados. Ignorarlo solo empeorar√° la situaci√≥n.'
                }
            ]);

            useEffect(() => {
                const loadData = async () => {
                    try {
                        const savedResults = await window.storage.get('student-results', true);
                        if (savedResults) {
                            setStudentResults(JSON.parse(savedResults.value));
                        }
                    } catch (error) {
                        console.log('No previous results found');
                    }
                };
                loadData();
            }, []);

            const saveResult = async (studentName, answers, results) => {
                const newResult = {
                    name: studentName,
                    date: new Date().toISOString(),
                    answers,
                    results
                };

                const updatedResults = [...studentResults, newResult];
                setStudentResults(updatedResults);

                try {
                    await window.storage.set('student-results', JSON.stringify(updatedResults), true);
                } catch (error) {
                    console.error('Error saving results:', error);
                }
            };

            const handleLogin = (type) => {
                if (type === 'student' && !studentName.trim()) {
                    alert('Por favor ingresa tu nombre');
                    return;
                }
                setUserType(type);
                if (type === 'student') {
                    setCurrentStudent(studentName);
                    setView('case');
                } else {
                    setView('professor');
                }
            };

            const handleAnswerChange = (questionId, value) => {
                setAnswers({ ...answers, [questionId]: value });
            };

            const checkAnswer = (question, userAnswer) => {
                if (question.type === 'multiple') {
                    return userAnswer === question.correct;
                } else if (question.type === 'truefalse') {
                    return userAnswer === question.correct;
                } else if (question.type === 'short') {
                    if (!userAnswer) return false;
                    const normalizedAnswer = userAnswer.toLowerCase().trim();
                    return question.correctAnswers.some(correct => 
                        normalizedAnswer.includes(correct.toLowerCase())
                    );
                }
                return false;
            };

            const handleSubmit = () => {
                const allAnswered = questions.every(q => answers[q.id] !== undefined && answers[q.id] !== '');
                
                if (!allAnswered) {
                    alert('Por favor responde todas las preguntas antes de enviar');
                    return;
                }

                const calculatedResults = questions.map(q => ({
                    question: q.question,
                    userAnswer: answers[q.id],
                    correct: checkAnswer(q, answers[q.id]),
                    feedback: q.feedback,
                    correctAnswer: q.type === 'multiple' ? q.options[q.correct] : 
                                 q.type === 'truefalse' ? (q.correct ? 'Verdadero' : 'Falso') :
                                 q.correctAnswers.join(', ')
                }));

                setResults(calculatedResults);
                setSubmitted(true);
                saveResult(currentStudent, answers, calculatedResults);
            };

            const exportResults = () => {
                const csv = [
                    ['Nombre', 'Fecha', 'Puntaje', 'Preguntas Correctas', 'Total Preguntas'].join(','),
                    ...studentResults.map(r => {
                        const correct = r.results.filter(res => res.correct).length;
                        const total = r.results.length;
                        const date = new Date(r.date).toLocaleString('es-PE');
                        return [r.name, date, `${correct}/${total}`, correct, total].join(',');
                    })
                ].join('\n');

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'resultados_estudiantes.csv';
                a.click();
            };

            const resetApp = () => {
                setView('login');
                setUserType(null);
                setStudentName('');
                setCurrentStudent(null);
                setAnswers({});
                setSubmitted(false);
                setResults(null);
            };

            if (view === 'login') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-cyan-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <h1 className="text-3xl font-bold text-center mb-2 text-gray-800">
                                Gesti√≥n de las Relaciones en las Organizaciones
                            </h1>
                            <p className="text-center text-gray-600 mb-8">Plataforma de An√°lisis de Casos</p>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Nombre del Estudiante
                                    </label>
                                    <input
                                        type="text"
                                        value={studentName}
                                        onChange={(e) => setStudentName(e.target.value)}
                                        placeholder="Ingresa tu nombre completo"
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                        onKeyPress={(e) => e.key === 'Enter' && handleLogin('student')}
                                    />
                                </div>
                                
                                <button
                                    onClick={() => handleLogin('student')}
                                    className="w-full bg-gradient-to-r from-blue-600 to-cyan-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-700 transition-all transform hover:scale-105"
                                >
                                    Ingresar como Estudiante
                                </button>
                                
                                <div className="relative my-6">
                                    <div className="absolute inset-0 flex items-center">
                                        <div className="w-full border-t border-gray-300"></div>
                                    </div>
                                    <div className="relative flex justify-center text-sm">
                                        <span className="px-2 bg-white text-gray-500">o</span>
                                    </div>
                                </div>
                                
                                <button
                                    onClick={() => handleLogin('professor')}
                                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all transform hover:scale-105 flex items-center justify-center gap-2"
                                >
                                    <Users />
                                    Vista de Profesor
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'professor') {
                return (
                    <div className="min-h-screen bg-gray-50 p-6">
                        <div className="max-w-6xl mx-auto">
                            <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-2">
                                        <BarChart3 />
                                        Panel de Profesor
                                    </h1>
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setEditMode(!editMode)}
                                            className={`px-4 py-2 rounded-lg font-semibold flex items-center gap-2 ${
                                                editMode ? 'bg-gray-500 text-white' : 'bg-blue-600 text-white hover:bg-blue-700'
                                            }`}
                                        >
                                            {editMode ? <X /> : <Edit2 />}
                                            {editMode ? 'Cancelar Edici√≥n' : 'Editar Contenido'}
                                        </button>
                                        <button
                                            onClick={exportResults}
                                            className="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 flex items-center gap-2"
                                            disabled={studentResults.length === 0}
                                        >
                                            <Download />
                                            Exportar Resultados
                                        </button>
                                        <button
                                            onClick={resetApp}
                                            className="px-4 py-2 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700"
                                        >
                                            Salir
                                        </button>
                                    </div>
                                </div>

                                {editMode ? (
                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">T√≠tulo del Caso</label>
                                            <input
                                                type="text"
                                                value={caseData.title}
                                                onChange={(e) => setCaseData({...caseData, title: e.target.value})}
                                                className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Contenido del Caso</label>
                                            <textarea
                                                value={caseData.content}
                                                onChange={(e) => setCaseData({...caseData, content: e.target.value})}
                                                rows={8}
                                                className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                            />
                                        </div>
                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <p className="text-sm text-blue-800">
                                                üí° <strong>Nota:</strong> Los cambios se guardan autom√°ticamente al cerrar el modo de edici√≥n.
                                            </p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-6">
                                        <div className="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg">
                                            <p className="text-lg font-semibold text-gray-800">
                                                Total de estudiantes: {studentResults.length}
                                            </p>
                                        </div>

                                        <div className="overflow-x-auto">
                                            <table className="w-full">
                                                <thead className="bg-gray-100">
                                                    <tr>
                                                        <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Estudiante</th>
                                                        <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Fecha</th>
                                                        <th className="px-4 py-3 text-center text-sm font-semibold text-gray-700">Puntaje</th>
                                                        <th className="px-4 py-3 text-center text-sm font-semibold text-gray-700">Porcentaje</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {studentResults.map((result, idx) => {
                                                        const correct = result.results.filter(r => r.correct).length;
                                                        const total = result.results.length;
                                                        const percentage = ((correct / total) * 100).toFixed(0);
                                                        
                                                        return (
                                                            <tr key={idx} className="border-b hover:bg-gray-50">
                                                                <td className="px-4 py-3 text-sm text-gray-800">{result.name}</td>
                                                                <td className="px-4 py-3 text-sm text-gray-600">
                                                                    {new Date(result.date).toLocaleString('es-PE')}
                                                                </td>
                                                                <td className="px-4 py-3 text-center">
                                                                    <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800">
                                                                        {correct}/{total}
                                                                    </span>
                                                                </td>
                                                                <td className="px-4 py-3 text-center">
                                                                    <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold ${
                                                                        percentage >= 70 ? 'bg-green-100 text-green-800' : 
                                                                        percentage >= 50 ? 'bg-yellow-100 text-yellow-800' : 
                                                                        'bg-red-100 text-red-800'
                                                                    }`}>
                                                                        {percentage}%
                                                                    </span>
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                            
                                            {studentResults.length === 0 && (
                                                <div className="text-center py-12 text-gray-500">
                                                    No hay resultados registrados a√∫n
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'case' && !submitted) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-xl shadow-lg p-8">
                                <div className="mb-6 flex justify-between items-center">
                                    <div>
                                        <h2 className="text-sm font-semibold text-purple-600 mb-1">Estudiante</h2>
                                        <p className="text-lg font-bold text-gray-800">{currentStudent}</p>
                                    </div>
                                    <button
                                        onClick={resetApp}
                                        className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                                    >
                                        Salir
                                    </button>
                                </div>

                                <div className="bg-gradient-to-r from-purple-100 to-blue-100 p-6 rounded-lg mb-8">
                                    <h1 className="text-2xl font-bold text-gray-800 mb-4">{caseData.title}</h1>
                                    <p className="text-gray-700 whitespace-pre-line leading-relaxed">{caseData.content}</p>
                                </div>

                                <div className="space-y-6">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4">Preguntas de An√°lisis</h2>
                                    
                                    {questions.map((q, idx) => (
                                        <div key={q.id} className="bg-gray-50 p-6 rounded-lg border-l-4 border-blue-500">
                                            <p className="font-semibold text-gray-800 mb-4">
                                                {idx + 1}. {q.question}
                                            </p>

                                            {q.type === 'multiple' && (
                                                <div className="space-y-2">
                                                    {q.options.map((option, optIdx) => (
                                                        <label key={optIdx} className="flex items-center space-x-3 p-3 bg-white rounded-lg hover:bg-blue-50 cursor-pointer">
                                                            <input
                                                                type="radio"
                                                                name={`q${q.id}`}
                                                                value={optIdx}
                                                                checked={answers[q.id] === optIdx}
                                                                onChange={(e) => handleAnswerChange(q.id, parseInt(e.target.value))}
                                                                className="w-4 h-4 text-blue-600"
                                                            />
                                                            <span className="text-gray-700">{option}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            )}

                                            {q.type === 'truefalse' && (
                                                <div className="space-y-2">
                                                    <label className="flex items-center space-x-3 p-3 bg-white rounded-lg hover:bg-blue-50 cursor-pointer">
                                                        <input
                                                            type="radio"
                                                            name={`q${q.id}`}
                                                            value="true"
                                                            checked={answers[q.id] === true}
                                                            onChange={() => handleAnswerChange(q.id, true)}
                                                            className="w-4 h-4 text-blue-600"
                                                        />
                                                        <span className="text-gray-700">Verdadero</span>
                                                    </label>
                                                    <label className="flex items-center space-x-3 p-3 bg-white rounded-lg hover:bg-blue-50 cursor-pointer">
                                                        <input
                                                            type="radio"
                                                            name={`q${q.id}`}
                                                            value="false"
                                                            checked={answers[q.id] === false}
                                                            onChange={() => handleAnswerChange(q.id, false)}
                                                            className="w-4 h-4 text-blue-600"
                                                        />
                                                        <span className="text-gray-700">Falso</span>
                                                    </label>
                                                </div>
                                            )}

                                            {q.type === 'short' && (
                                                <textarea
                                                    value={answers[q.id] || ''}
                                                    onChange={(e) => handleAnswerChange(q.id, e.target.value)}
                                                    placeholder="Escribe tu respuesta aqu√≠..."
                                                    rows={3}
                                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                                />
                                            )}
                                        </div>
                                    ))}

                                    <button
                                        onClick={handleSubmit}
                                        className="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-4 rounded-lg font-bold text-lg hover:from-green-700 hover:to-blue-700 transition-all transform hover:scale-105"
                                    >
                                        Enviar Respuestas
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (submitted && results) {
                const correctCount = results.filter(r => r.correct).length;
                const totalCount = results.length;
                const percentage = ((correctCount / totalCount) * 100).toFixed(0);

                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-6">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-xl shadow-lg p-8">
                                <h1 className="text-3xl font-bold text-center mb-2 text-gray-800">
                                    ¬°Resultados!
                                </h1>
                                <p className="text-center text-gray-600 mb-6">{currentStudent}</p>

                                <div className="bg-gradient-to-r from-blue-500 to-purple-600 p-6 rounded-lg mb-8 text-white text-center">
                                    <p className="text-5xl font-bold mb-2">{correctCount}/{totalCount}</p>
                                    <p className="text-xl">Puntaje Final: {percentage}%</p>
                                </div>

                                <div className="space-y-6">
                                    {results.map((result, idx) => (
                                        <div key={idx} className={`p-6 rounded-lg border-l-4 ${
                                            result.correct ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'
                                        }`}>
                                            <div className="flex items-start justify-between mb-3">
                                                <p className="font-semibold text-gray-800 flex-1">
                                                    {idx + 1}. {result.question}
                                                </p>
                                                <span className={`px-3 py-1 rounded-full text-sm font-bold ${
                                                    result.correct ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'
                                                }`}>
                                                    {result.correct ? '‚úì Correcto' : '‚úó Incorrecto'}
                                                </span>
                                            </div>

                                            <div className="space-y-2 text-sm">
                                                <p className="text-gray-700">
                                                    <strong>Tu respuesta:</strong>{' '}
                                                    {typeof result.userAnswer === 'boolean'<button
                                onClick={resetApp}
                                className="w-full mt-8 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-lg font-bold text-lg hover:from-blue-700 hover:to-purple-700 transition-all"
                            >
                                Finalizar
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        return null;
    };

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
