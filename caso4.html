<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caso 4: Almacenes Futura en la Tormenta</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <style>
        /* ESTILOS VISUALES */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, 'Segoe UI', sans-serif; background: #fff7ed; color: #1e293b; padding-bottom: 50px; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 20px; }
        
        /* Botones (Tema Naranja para Caso 4) */
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-size: 14px; transition: all 0.2s; }
        .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn-primary { background: #ea580c; color: white; } /* Naranja */
        .btn-secondary { background: #4338ca; color: white; }
        .btn-success { background: #16a34a; color: white; }
        .btn-danger { background: #dc2626; color: white; }
        .btn-outline { background: white; border: 1px solid #cbd5e1; color: #475569; }
        
        .input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; margin-bottom: 12px; }
        .input:focus { outline: none; border-color: #ea580c; ring: 2px solid #fdba74; }
        
        .login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #fff7ed, #ea580c); padding: 20px; }
        
        /* Estilos del Caso */
        .case-title { color: #c2410c; font-size: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #fdba74; padding-bottom: 10px; }
        .case-content { line-height: 1.7; color: #334155; white-space: pre-line; padding: 25px; background: #fff7ed; border-radius: 8px; border-left: 5px solid #ea580c; font-size: 15px; margin-bottom: 30px; }
        
        .question-card { margin-bottom: 25px; padding: 20px; border: 1px solid #e2e8f0; border-radius: 10px; background: #fff; }
        .option-label { display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; }
        .option-label:hover { background: #fff7ed; }
        .option-label.selected { background: #ffedd5; border-color: #ea580c; font-weight: 500; }
        
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .anim-fade { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ðŸ” CONFIGURACIÃ“N ---
        const CONFIG = {
            studentPass: "EXITO",     
            adminPass: "profesor123", 
            salt: "CLAVE_CASO4_FUTURA",      
            storageKey: "results_c4"  // ðŸ”´ CLAVE ÃšNICA PARA CASO 4
        };

        // --- ðŸ“ TEXTO DEL CASO ---
        const DEFAULT_CASE = {
            title: "Caso 4: Almacenes Futura en la Tormenta",
            content: `1. El Contexto (El Sistema)
"Almacenes Futura" es un gigante minorista con 30 aÃ±os de Ã©xito. HistÃ³ricamente, funcionÃ³ como un reloj suizo: recibÃ­a productos de grandes proveedores (Entrada), los distribuÃ­a en tiendas fÃ­sicas estandarizadas (Proceso) y vendÃ­a masivamente al pÃºblico (Salida). Era un modelo predecible y eficiente.

2. El Quiebre (El Entorno VUCA)
Sin embargo, en los Ãºltimos 12 meses, el "Entorno EspecÃ­fico" se volviÃ³ hostil. Han aparecido competidores digitales que entregan en 2 horas, alterando los hÃ¡bitos de consumo. La gerencia detecta dos amenazas crÃ­ticas:
- Volatilidad extrema: Los precios de la competencia cambian automÃ¡ticamente cada hora mediante algoritmos.
- Complejidad: Nuevas leyes de protecciÃ³n de datos bloquean sus campaÃ±as de marketing antiguas, y la crisis logÃ­stica global ha roto su cadena de suministro.

3. El Conflicto Interno (Personas y TecnologÃ­a)
Dentro de la empresa, el sistema "humano" estÃ¡ fallando. La directiva invirtiÃ³ millones en una Inteligencia Artificial (recurso tecnolÃ³gico), pero la implementaciÃ³n fue un desastre.
- Los empleados de la GeneraciÃ³n X (y algunos Boomers) boicotean el sistema por miedo a ser reemplazados.
- Los nuevos talentos Centennials (Gen Z) estÃ¡n renunciando porque encuentran la estructura jerÃ¡rquica demasiado lenta y rÃ­gida.
Como dirÃ­a Peter Drucker, los recursos estÃ¡n "inertes": hay tecnologÃ­a y hay gente, pero no producen valor juntos.

4. El DesafÃ­o del CEO
El Directorio exige resultados inmediatos. El CEO enfrenta una encrucijada crÃ­tica: Â¿Debe mantener su estructura tradicional para intentar recuperar el control (Sistema Cerrado), o debe rediseÃ±ar la organizaciÃ³n para convertirla en un Sistema Abierto y Ãgil, capaz de integrar la tecnologÃ­a y el talento joven para responder a la velocidad del mercado?`
        };

        // --- â“ PREGUNTAS (Adaptadas al texto) ---
        const DEFAULT_QUESTIONS = [
            { 
                id: 1, type: 'multiple', 
                question: 'SegÃºn el caso, los "cambios automÃ¡ticos de precios cada hora" corresponden a quÃ© caracterÃ­stica del entorno VUCA:', 
                options: ['AmbigÃ¼edad', 'Volatilidad', 'Incertidumbre', 'Estabilidad'], 
                correct: 1, 
                feedback: 'Correcto. La Volatilidad se refiere a la velocidad y dinÃ¡mica de los cambios.' 
            },
            { 
                id: 2, type: 'multiple', 
                question: 'El CEO estÃ¡ considerando rediseÃ±ar la organizaciÃ³n para responder al mercado. Esto implica transformarla en un:', 
                options: ['Sistema Cerrado', 'Sistema MecÃ¡nico', 'Sistema Abierto', 'Monopolio'], 
                correct: 2, 
                feedback: 'Correcto. Un Sistema Abierto interactÃºa y se adapta constantemente a su entorno.' 
            },
            { 
                id: 3, type: 'truefalse', 
                question: 'V/F: SegÃºn Peter Drucker, la tecnologÃ­a por sÃ­ misma genera valor aunque los empleados la boicoteen.', 
                options: [], 
                correct: false, 
                feedback: 'Falso. Los recursos estÃ¡n "inertes" si el factor humano no los activa productivamente.' 
            },
            { 
                id: 4, type: 'multiple', 
                question: 'Â¿CuÃ¡l es el conflicto principal con el recurso humano "GeneraciÃ³n X"?', 
                options: ['Falta de capacidad tÃ©cnica', 'Miedo a ser reemplazados', 'Exceso de velocidad en el trabajo', 'Falta de leyes laborales'], 
                correct: 1, 
                feedback: 'Correcto. El texto menciona explÃ­citamente el miedo al reemplazo por la IA.' 
            },
            { 
                id: 5, type: 'short', 
                question: 'Complete la frase: Las nuevas leyes de protecciÃ³n de datos representan un aumento de la _______ en el entorno.', 
                correctAnswers: ['complejidad', 'compleja'], 
                feedback: 'Correcto: Complejidad (multiplicidad de factores interconectados).' 
            }
        ];

        // --- FUNCIONES AUXILIARES ---
        const generateAuthCode = (name, score, max) => {
            const cleanName = name.replace(/\s/g, '').toUpperCase().substring(0, 4);
            const raw = `${cleanName}-${score}/${max}-${CONFIG.salt}`;
            return btoa(raw).substring(0, 12).toUpperCase();
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            const [view, setView] = useState('login');
            const [user, setUser] = useState({ name: '', role: '' });
            const [shuffledQuestions, setShuffledQuestions] = useState([]);
            const [answers, setAnswers] = useState({});
            const [result, setResult] = useState(null);
            const [adminPassInput, setAdminPassInput] = useState('');
            const [validationInput, setValidationInput] = useState('');
            const [allResults, setAllResults] = useState([]);

            // Cargar datos al inicio
            useEffect(() => {
                const stored = localStorage.getItem(CONFIG.storageKey);
                if (stored) setAllResults(JSON.parse(stored));
            }, []);

            // --- LÃ“GICA ALUMNO ---
            const startExam = (name, code) => {
                if(code.toUpperCase() !== CONFIG.studentPass) return alert("CÃ³digo incorrecto (Prueba con: EXITO)");
                if(!name.trim()) return alert("Falta el nombre");
                
                setUser({ name, role: 'student' });
                
                // Mezcla (Shuffle)
                const qCopy = DEFAULT_QUESTIONS.map(q => {
                    if(q.type === 'multiple') {
                        const optsWithIdx = q.options.map((o, i) => ({txt: o, idx: i}));
                        optsWithIdx.sort(() => Math.random() - 0.5);
                        return { ...q, _shuffledOpts: optsWithIdx };
                    }
                    return q;
                }).sort(() => Math.random() - 0.5);
                
                setShuffledQuestions(qCopy);
                setView('exam');
            };

            const submitExam = () => {
                if(shuffledQuestions.some(q => answers[q.id] === undefined)) {
                    if(!confirm("Hay preguntas vacÃ­as. Â¿Enviar de todas formas?")) return;
                }

                let score = 0;
                const detailedResults = shuffledQuestions.map(q => {
                    const userAns = answers[q.id];
                    let isCorrect = false;

                    if (q.type === 'multiple') {
                        const selectedOptObj = q._shuffledOpts[userAns];
                        if (selectedOptObj && selectedOptObj.idx === q.correct) isCorrect = true;
                    } 
                    else if (q.type === 'truefalse') isCorrect = userAns === q.correct;
                    else if (q.type === 'short') {
                        const cleanAns = (userAns || '').toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                        isCorrect = q.correctAnswers.some(a => cleanAns.includes(a.normalize("NFD").replace(/[\u0300-\u036f]/g, "")));
                    }

                    if(isCorrect) score++;
                    return { ...q, isCorrect, userAns };
                });

                const finalCode = generateAuthCode(user.name, score, DEFAULT_QUESTIONS.length);
                
                const finalResult = {
                    date: new Date().toLocaleString(),
                    name: user.name,
                    score,
                    total: DEFAULT_QUESTIONS.length,
                    code: finalCode,
                    details: detailedResults
                };

                setResult(finalResult);
                
                const newHistory = [...allResults, finalResult];
                setAllResults(newHistory);
                localStorage.setItem(CONFIG.storageKey, JSON.stringify(newHistory));
                
                setView('results');
            };

            // --- VISTAS ---
            if(view === 'login') {
                return (
                    <div className="login-screen">
                        <div className="card" style={{maxWidth:'400px', width:'100%', textAlign:'center'}}>
                            <i className="ri-building-3-line" style={{fontSize:'3rem', color:'#ea580c'}}></i>
                            <h2 style={{marginTop:'10px', color:'#c2410c'}}>Caso 4</h2>
                            <p style={{color:'#64748b', marginBottom:'20px'}}>Almacenes Futura</p>
                            
                            <form onSubmit={e => { e.preventDefault(); startExam(e.target.student.value, e.target.code.value); }}>
                                <label className="badge" style={{background:'#ffedd5', color:'#c2410c', marginBottom:'5px', display:'inline-block'}}>Estudiante</label>
                                <input name="student" className="input" placeholder="Nombre Completo" required />
                                <input name="code" className="input" placeholder="CÃ³digo (EXITO)" required />
                                <button className="btn btn-primary" style={{width:'100%', justifyContent:'center'}}>Comenzar Caso</button>
                            </form>
                            
                            <div style={{marginTop:'30px', paddingTop:'20px', borderTop:'1px solid #fed7aa'}}>
                                <label className="badge badge-red">Profesor</label>
                                <div style={{display:'flex', gap:'5px', marginTop:'5px'}}>
                                    <input type="password" className="input" style={{marginBottom:0}} placeholder="ContraseÃ±a Admin" value={adminPassInput} onChange={e=>setAdminPassInput(e.target.value)} />
                                    <button className="btn btn-secondary" onClick={() => adminPassInput === CONFIG.adminPass ? setView('admin') : alert('Error')}>Entrar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if(view === 'exam') {
                return (
                    <div className="container anim-fade">
                        <div className="card">
                            <div style={{display:'flex', justifyContent:'space-between', marginBottom:'15px'}}>
                                <h2 style={{color:'#ea580c'}}>{DEFAULT_CASE.title}</h2>
                                <span className="badge" style={{background:'#ffedd5', color:'#c2410c'}}>{user.name}</span>
                            </div>
                            <div className="case-content">{DEFAULT_CASE.content}</div>
                            
                            <h3 style={{marginBottom:'15px', color:'#c2410c'}}>Cuestionario</h3>
                            {shuffledQuestions.map((q, idx) => (
                                <div key={q.id} className="question-card">
                                    <p style={{fontWeight:'bold', marginBottom:'10px'}}>{idx + 1}. {q.question}</p>
                                    {q.type === 'multiple' && q._shuffledOpts.map((opt, i) => (
                                        <div key={i} className={`option-label ${answers[q.id] === i ? 'selected' : ''}`} onClick={() => setAnswers({...answers, [q.id]: i})}>
                                            <div style={{width:'18px', height:'18px', borderRadius:'50%', border:'2px solid #cbd5e1', marginRight:'10px', background: answers[q.id] === i ? '#ea580c' : 'transparent'}}></div>
                                            {opt.txt}
                                        </div>
                                    ))}
                                    {q.type === 'truefalse' && (
                                        <div style={{display:'flex', gap:'10px'}}>
                                            <button className={`btn ${answers[q.id] === true ? 'btn-primary' : 'btn-outline'}`} onClick={()=>setAnswers({...answers, [q.id]: true})}>Verdadero</button>
                                            <button className={`btn ${answers[q.id] === false ? 'btn-primary' : 'btn-outline'}`} onClick={()=>setAnswers({...answers, [q.id]: false})}>Falso</button>
                                        </div>
                                    )}
                                    {q.type === 'short' && <input className="input" placeholder="Tu respuesta..." onChange={e => setAnswers({...answers, [q.id]: e.target.value})} />}
                                </div>
                            ))}
                            <button className="btn btn-success" style={{width:'100%', justifyContent:'center', padding:'15px'}} onClick={submitExam}>Finalizar Examen</button>
                        </div>
                    </div>
                );
            }

            if(view === 'results' && result) {
                return (
                    <div className="container anim-fade">
                        <div className="card" style={{textAlign:'center', borderTop:'5px solid #16a34a'}}>
                            <h1 style={{color:'#166534'}}>Â¡Caso Finalizado!</h1>
                            <div style={{fontSize:'3rem', fontWeight:'bold', margin:'20px 0', color:'#1e293b'}}>{result.score} / {result.total}</div>
                            <div style={{background:'#f1f5f9', padding:'15px', borderRadius:'8px', margin:'20px 0'}}>
                                <p style={{fontSize:'12px', fontWeight:'bold', color:'#64748b'}}>CÃ“DIGO DE VERIFICACIÃ“N</p>
                                <p style={{fontFamily:'monospace', fontSize:'20px', letterSpacing:'2px', color:'#0f172a'}}>{result.code}</p>
                            </div>
                            <div style={{textAlign:'left'}}>
                                {result.details.map((r, i) => (
                                    <div key={i} style={{padding:'10px', borderBottom:'1px solid #f1f5f9'}}>
                                        <strong style={{color: r.isCorrect ? '#16a34a' : '#dc2626'}}>{r.isCorrect ? 'Correcto' : 'Incorrecto'}</strong> - P{i+1}
                                        {!r.isCorrect && <div style={{fontSize:'13px', color:'#64748b', marginTop:'4px'}}>{r.feedback}</div>}
                                    </div>
                                ))}
                            </div>
                            <button className="btn btn-outline" style={{marginTop:'20px'}} onClick={() => setView('login')}>Salir</button>
                        </div>
                    </div>
                );
            }

            if(view === 'admin') {
                const downloadCSV = () => {
                    const csv = "Fecha,Alumno,Nota,Total,Codigo\n" + allResults.map(r => `${r.date},${r.name},${r.score},${r.total},${r.code}`).join("\n");
                    const link = document.createElement("a");
                    link.href = "data:text/csv;charset=utf-8," + encodeURI(csv);
                    link.download = "notas_caso4.csv";
                    link.click();
                };

                return (
                    <div className="container anim-fade">
                        <div className="card">
                            <div style={{display:'flex', justifyContent:'space-between'}}>
                                <h1>Panel Docente: Caso 4</h1>
                                <button className="btn btn-outline" onClick={() => setView('login')}>Salir</button>
                            </div>
                            <div style={{margin:'20px 0', display:'flex', gap:'10px'}}>
                                <button className="btn btn-success" onClick={downloadCSV}>Descargar Excel</button>
                                <button className="btn btn-danger" onClick={() => {if(confirm("Â¿Borrar todas las notas del Caso 4?")) {localStorage.removeItem(CONFIG.storageKey); setAllResults([]);}}}>Borrar Todo</button>
                            </div>
                            <div style={{background:'#fff7ed', padding:'15px', borderRadius:'8px', marginBottom:'20px', border:'1px solid #fed7aa'}}>
                                <p style={{fontSize:'12px', fontWeight:'bold', color:'#c2410c'}}>VALIDADOR DE CÃ“DIGO</p>
                                <div style={{display:'flex', gap:'10px', marginTop:'5px'}}>
                                    <input className="input" style={{marginBottom:0}} placeholder="Pegar cÃ³digo..." value={validationInput} onChange={e=>setValidationInput(e.target.value)} />
                                    <button className="btn btn-primary" onClick={()=>{ try{ atob(validationInput); alert("âœ… CÃ³digo VÃ¡lido"); }catch(e){ alert("âŒ CÃ³digo InvÃ¡lido"); } }}>Verificar</button>
                                </div>
                            </div>
                            <table style={{width:'100%', borderCollapse:'collapse'}}>
                                <thead><tr style={{background:'#f1f5f9', textAlign:'left'}}><th style={{padding:'10px'}}>Fecha</th><th>Alumno</th><th>Nota</th><th>CÃ³digo</th></tr></thead>
                                <tbody>
                                    {allResults.slice().reverse().map((r, i) => (
                                        <tr key={i} style={{borderBottom:'1px solid #e2e8f0'}}>
                                            <td style={{padding:'10px', fontSize:'13px'}}>{r.date}</td>
                                            <td>{r.name}</td>
                                            <td><span className={`badge ${r.score >= r.total/2 ? 'badge-green' : 'badge-red'}`}>{r.score}/{r.total}</span></td>
                                            <td style={{fontFamily:'monospace', fontSize:'12px'}}>{r.code}</td>
                                        </tr>
                                    ))}
                                    {allResults.length === 0 && <tr><td colSpan="4" style={{padding:'20px', textAlign:'center', color:'#94a3b8'}}>No hay registros aÃºn en Caso 4.</td></tr>}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
